---
title: "p8105_hw2_vc2692"
output: github_document
date: "2025-09-27"
---

```{r - loading tidyverse}
library(tidyverse)
library(readxl)
```

# Problem 1

## Cleaning pols-month.csv

```{r - cleaning pols-month}

pols_month_df =
  read_csv("dataset/fivethirtyeight_datasets/pols-month.csv") |> 
  separate (
    mon, into = c("year", "month", "day"), sep = "-"
  ) |> 
  mutate(month = month.name[as.integer(month)]) |> 
  mutate(month = str_to_lower(month),
         year = as.integer(year)) |> 
  pivot_longer(
    cols = c(prez_gop, prez_dem),
    names_to = "president",
    values_to = "president_value",
    names_prefix = "prez_"
  ) |> 
  filter(president_value == 1) |> 
  select (-day, -president_value)
         
```

## Cleaning snp.csv

```{r - cleaning snp}

snp_df = 
  read_csv("dataset/fivethirtyeight_datasets/snp.csv") |> 
  separate (
    date, into = c("month", "day", "year"), sep = "/"
  ) |> 
  mutate(month = month.name[as.integer(month)]) |> 
  mutate(month = str_to_lower(month)) |> 
  select(-day) |> 
  mutate(
    year_int = as.integer(year),
    year_full = if_else(year_int >= 0  & year_int <=15, 2000 + year_int, 1900 + year_int)
  ) |> 
  select(-year, -year_int) |> 
  rename(year = year_full) |> 
  relocate(year)
```

## cleaning unemployment.csv

```{r - cleaning unemployment}
unemployment_df = 
  read_csv("dataset/fivethirtyeight_datasets/unemployment.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = jan:dec,
    names_to = "month",
    values_to = "percent_unemp"
  ) |> 
   mutate(month = month.name[match(month, month)]) |> 
  mutate(month = str_to_lower(month))
  
```

## Joining the three datasets

```{r - join pols snp unemployment}
pols_snp_joined =
  left_join(pols_month_df, snp_df, by = c("year", "month"))
all_joined = 
  left_join(pols_snp_joined, unemployment_df, by = c("year", "month"))
```


The three datasets that were joined in problem 1 are `pols-month`, `snp` and `unemployement`. `Pols_month_df` included data on the number of national politicians who are democratic or republican from January 1947-June 2015. `Snp_df` included the closing values of the S&P stock index from each month from January 1950-July 2015. `Unemployment_df` included the percentage of unemployment for each month from January 1948-December 2015. The resulting joined data set has 817 observations and 11 variables. It includes information from January 1947-June 2015, since `snp_df` was merged into `pols_month_df`, and then `unemployment` was merged last. Key variables include the number of national politicians who are republican/democrat, along with the unemployment proportion, and closing values of the S&P stock index.


# Problem 2

## Cleaning Mr Trash Wheel
```{r - Cleaning Mr Trash}
mr_trash_df =
  read_excel("dataset/trash_wheel_data_2025.xlsx", 
             sheet = "Mr. Trash Wheel",
             na = c(".", "NA", ""),
             range = "A2:N709" ) |> 
  janitor::clean_names() |> 
  mutate(sports_balls = as.integer(round(sports_balls))) |> 
  mutate(wheel_name = "Mr") |> 
  mutate(year = as.integer(year))
```

## Cleaning Professor Trash Wheel

```{r - Cleaning Professor Trash Wheel}
professor_trash_df = 
  read_excel("dataset/trash_wheel_data_2025.xlsx", 
             sheet = "Professor Trash Wheel",
             na = c(".", "NA", ""),
             range = "A2:M134" ) |> 
  janitor::clean_names() |>
  filter(dumpster != 119) |> 
  mutate(wheel_name = "Professor") |> 
  mutate(year = as.integer(year))
```

## Cleaning Gwynns Falls Trash Wheel
```{r - Cleaning Gwynns Falls Trash Wheel}
gwynns_trash_df = 
  read_excel("dataset/trash_wheel_data_2025.xlsx", 
             sheet = "Gwynns Falls Trash Wheel",
             na = c(".", "NA", ""),
             range = "A2:L351" ) |> 
  janitor::clean_names() |> 
  mutate(wheel_name = "Gwynns Falls") |> 
  mutate(year = as.integer(year))
```

## Joining the three trash wheel datasets

```{r - joning three trash wheel datasets}

all_wheels_joined = 
  bind_rows(mr_trash_df, professor_trash_df, gwynns_trash_df) |> 
  relocate(wheel_name)

```

## Summary statistics for description

```{r - trash wheel statistics}

professor_total_weight =
  all_wheels_joined |> 
  filter(wheel_name == "Professor") |> 
  summarise(sum(weight_tons, na.rm = TRUE))

cigarettes_gwynn_june2022 = 
  all_wheels_joined |> 
  filter(month == "June", year == 2022, wheel_name == "Gwynns Falls") |> 
  summarise(sum(cigarette_butts, na.rm = TRUE))

```


The `all_wheels_joined` dataframe provides information on water-wheel vessels that remove trash from Inner Harbor located in Baltimore, Maryland. It provides information on the number of dumpsters that the wheels fill with trash, the amounts of different types of litter collected, and the date at which this data is collected. Some examples of litter types include plastic bags, cigarette butts, and glass bottles. There are `r nrow(all_wheels_joined)` observations in the combined dataset, which include information on trash collected by Mr. Trash Wheel from May 2014-July 2025, Professor Trash Wheel from January 2017-July 2025, and Gwynns Falls trash wheel from July 2021-July 2025.

For available data, the total weight of trash collected by Professor Trash Wheel is `r professor_total_weight` tons. Additionally, the total number of cigarette butts collected by Gwynns Falls Trash Wheel in June of 2022 was `r cigarettes_gwynn_june2022`. 


# Question 3

## Cleaning zillow rental price dataset
```{r - rental price dataset}
rental_price_df =
  read_csv("dataset/zillow_data/zillow_rental_price_dataset.csv", 
           na = c(".", "NA", "")) |> 
  janitor::clean_names() |> 
  mutate(county_name = str_remove(county_name, " County$")) |> 
  rename(zip_code = region_name) |> 
  rename(county = county_name) |> 
  pivot_longer(
    cols = x2015_01_31:x2024_08_31,
    names_to = "date",
    names_prefix = "x",
    values_to = "rental_price"
  ) |> 
  separate(
    date, into = c("year", "month", "day"), sep = "_"
  ) |>
  relocate(zip_code) |> 
  select(-region_id, -size_rank, -region_type, -state_name, -state, -city, -metro)

```

##Cleaning zipcode dataset
```{r - zipcode dataset}
zip_code_df =
  read_csv("dataset/zillow_data/zip_codes.csv", 
           na = c(".", "NA", "")) |> 
  janitor::clean_names() |> 
  relocate(zip_code) |> 
  select(-state_fips, -county_code, -county_fips, -file_date)
```


## Joining zillow and zipcode dataset
```{r}
zillow_and_zips =
  left_join(rental_price_df, zip_code_df, by = c("zip_code", "county")) |> 
  select(year, month, day, county, zip_code, neighborhood, rental_price)
```


The `zillow_and_zips` dataset includes rental price information for a given zipcode in NYC from January 2015-August 2024. There is also country and neighborhood information for the given zipcode included in this dataset. There are `r n_distinct(zillow_and_zips$zip_code)` unique zip codes and `r n_distinct(zillow_and_zips$neighborhood)` unique neighborhoods. 

##Zipcodes not in Zillow data

```{r - zipcodes not in zillow}
only_zipcode_dataset_zipcodes = 
  anti_join(zip_code_df, rental_price_df, by = "zip_code")

```

There are `r nrow(only_zipcode_dataset_zipcodes)` that were included in the zip_code_df but not in the rental_price_df containing information from Zillow. Some zipcodes that are included in the `only_zipcode_dataset_zipcodes` dataset include Southeast Bronx, Northeast Bronx, and Hunts Point and Mott Haven. This may be because these zip codes don't have any rental buildings/houses that are included on Zillow. 

## Zipcodes with largest price decrease from Jan 2020 to Jan 2021
```{r - price decrease}
ten_largest_price_decrease =
  zillow_and_zips |> 
  filter(year %in% c(2020, 2021)) |> 
  filter(month == "01") |> 
  pivot_wider(
    names_from = year,
    values_from = rental_price) |> 
  mutate( price_diff_2020_2021 = `2020`- `2021`) |> 
  arrange(desc(price_diff_2020_2021)) |> 
  slice_head(n=10) |> 
  select(county, neighborhood,price_diff_2020_2021 )
  
ten_largest_price_decrease
```

The above table shows 10 ZIP codes (along with the borough and neighborhood) with largest drop in price from January 2020 to 2021. They are all in in New York County / Manhattan. The top ten decreases range from $913 to $685. 
